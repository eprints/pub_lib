<?xml version="1.0" encoding="utf-8"?>

<stage name="core" xmlns="http://eprints.org/ep3/workflow" xmlns:epc="http://eprints.org/ep3/control">

  <component id="c_title"><field ref="title" required="yes" input_lookup_url="{$config{rel_cgipath}}/users/lookup/title_duplicates" input_lookup_params="id={eprintid}&amp;dataset=eprint&amp;field=title" /></component>
  <component id="c_abstract"><field ref="abstract"/></component>

  <epc:if test="type = 'monograph'">
    <component id="c_monograph_type"><field ref="monograph_type" required="yes" /></component>
  </epc:if>
  <epc:if test="type = 'thesis'">
    <component id="c_thesis_type"><field ref="thesis_type" required="yes" /></component>
    <component id="c_thesis_name"><field ref="thesis_name" required="yes" /></component>
  </epc:if>
  <epc:if test="type = 'conference_item'">
    <component id="c_pres_type"><field ref="pres_type" required="yes" /></component>
  </epc:if>
  <epc:if test="type = 'composition'">
    <component id="c_composition_type"><field ref="composition_type" required="yes" /></component>
  </epc:if>
  <epc:if test="type = 'dataset'">
    <component id="c_data_type"><field ref="data_type" required="yes" /></component>
  </epc:if>

<!--
  <epc:choose>
    <epc:when test="type.one_of('book','book_section')">
      <component id="c_creators"><field ref="creators" input_lookup_url="{$config{rel_cgipath}}/users/lookup/name" /></component>
      <component id="c_corp_creators">><field ref="corp_creators"/></component>
      <component id="c_editors">><field ref="editors" input_lookup_url="{$config{rel_cgipath}}/users/lookup/name" /></component>
    </epc:when>
    <epc:otherwise>
      <component id="c_creators">><field ref="creators" required="yes" input_lookup_url="{$config{rel_cgipath}}/users/lookup/name" /></component>
      <component id="c_corp_creators">><field ref="corp_creators"/></component>
    </epc:otherwise>
  </epc:choose>
  <component id="c_contributors">><field ref="contributors" /></component>
-->
  <component id="c_contributions">><field ref="contributions" /></component>

  <epc:if test="type = 'exhibition'">
    <component id="c_num_pieces">><field ref="num_pieces"/></component>
  </epc:if>

  <component id="c_divisions">><field ref="divisions" /></component>

  <component id="c_publication_details" type="Field::Multi">
	  <title><epc:phrase ref="archive:workflow:stage:core:publication_details:title" /></title>
    <epc:if test="type != 'patent' ">
      <epc:if test="type.one_of('book_section', 'book', 'article', 'conference_item')">
        <field ref="refereed" required="yes" />
      </epc:if>
      <epc:if test="type != 'artefact' and type != 'exhibition'">
        <field ref="ispublished" required="yes" />
      </epc:if>
    </epc:if>

    <epc:if test='type = "patent"'>
      <field ref="official_url"/>
<!--  <field ref="patent_applicant" required="yes" /> -->
      <field ref="pages"/>
    </epc:if>
    <epc:if test="type = 'monograph'">
      <field ref="institution"/>
      <field ref="department"/>
      <field ref="place_of_pub"/>
<!--  <field ref="publisher" required="yes" /> -->
      <field ref="pages"/>
      <field ref="official_url"/>
    </epc:if>
    <epc:if test="type = 'book'">
      <field ref="place_of_pub"/>
<!--  <field ref="publisher" required="yes" /> -->
      <field ref="pages"/>
      <field ref="series"/>
      <field ref="volume"/>
      <field ref="number"/>
      <field ref="edition"/>
      <field ref="official_url"/>
    </epc:if>
    <epc:if test="type = 'other'">
      <field ref="official_url"/>
      <field ref="place_of_pub"/>
<!--  <field ref="publisher" required="yes" /> -->
    </epc:if>
    <epc:if test="type = 'book_section'">
      <field ref="pagerange"/>
      <field ref="book_title" required="yes" />
      <field ref="volume"/>
      <field ref="place_of_pub"/>
<!--  <field ref="publisher" required="yes" /> -->
      <field ref="pages"/>
      <field ref="series"/>
      <field ref="number"/>
      <field ref="edition"/>
      <field ref="official_url"/>
    </epc:if>
    <epc:if test="type = 'thesis'">
      <field ref="official_url"/>
      <field ref="institution" required="yes" />
      <field ref="department" required="yes" />
      <field ref="pages"/>
    </epc:if>
    <epc:if test="type = 'conference_item'">
      <field ref="pagerange"/>
      <field ref="official_url"/>
    </epc:if>
    <epc:if test="type = 'article'">
      <field ref="publication" required="yes" input_lookup_url="{$config{rel_cgipath}}/users/lookup/journal_by_name" />
<!--  <field ref="publisher" /> -->
      <field ref="official_url"/>
      <field ref="volume"/>
      <field ref="number"/>
      <field ref="article_number"/>
      <field ref="pagerange"/>
    </epc:if>
    <epc:if test="type = 'artefact'">
      <field ref="output_media"/>
      <field ref="official_url"/>
    </epc:if>
    <epc:if test="type = 'exhibition'">
      <field ref="output_media"/>
      <field ref="official_url"/>
    </epc:if>
    <epc:if test="type = 'composition'">
      <field ref="output_media"/>
<!--  <field ref="publisher" /> -->
      <field ref="official_url"/>
    </epc:if>
    <epc:if test="type = 'performance'">
      <field ref="output_media"/>
<!--  <field ref="publisher" /> -->
      <field ref="official_url"/>
    </epc:if>
    <epc:if test="type = 'image'">
      <field ref="output_media"/>
<!--  <field ref="publisher" /> -->
      <field ref="official_url"/>
    </epc:if>
    <epc:if test="type = 'video'">
      <field ref="output_media"/>
<!--  <field ref="publisher" /> -->
      <field ref="official_url"/>
    </epc:if>
    <epc:if test="type = 'audio'">
      <field ref="output_media"/>
<!--  <field ref="publisher" /> -->
      <field ref="official_url"/>
    </epc:if>
    <epc:if test="type = 'dataset'">
      <field ref="output_media"/>
<!--  <field ref="publisher"/> -->
      <field ref="official_url"/>
    </epc:if>
    <epc:if test="type = 'experiment'">
      <field ref="official_url"/>
    </epc:if>
    <epc:if test="type = 'teaching_resource'">
<!--      <field ref="copyright_holders"/> -->
<!--  <field ref="publisher"/> -->
      <field ref="official_url"/>
    </epc:if>
    <field ref="related_url" />
  </component>

  <component id="c_ids"><field ref="ids"/></component>
  <epc:choose>
      <epc:when test="type.one_of('patent','thesis')">
          <component id="c_dates"><field ref="dates" required="yes"/></component>
      </epc:when>
      <epc:otherwise>
          <component id="c_dates"><field ref="dates"/></component>
      </epc:otherwise>
  </epc:choose>
<!--  <component id="c_funders"><field ref="funders" /></component> -->
  <component id="c_projects"><field ref="projects" /></component>

  <epc:if test="type = 'teaching_resource'">
    <component id="c_pedagogic_details" type="Field::Multi">
      <title><epc:phrase ref="archive:workflow:stage:core:pedagogic_details:title" /></title>
      <field ref="pedagogic_type"/>
      <field ref="completion_time"/>
      <field ref="task_purpose"/>
      <field ref="skill_areas"/>
      <field ref="learning_level"/>
    </component>
  </epc:if>

  <epc:if test="type.one_of( 'exhibition', 'performance' )">
    <component id="c_venue_details" type="Field::Multi">
      <title><epc:phrase ref="archive:workflow:stage:core:venue_details:title" /></title>
      <field ref="event_title" />
      <field ref="event_location"/>
      <field ref="event_dates"/>
    </component>
  </epc:if>

  <epc:if test="type = 'conference_item'">
    <component id="c_event_details" type="Field::Multi">
      <title><epc:phrase ref="archive:workflow:stage:core:event_details:title" /></title>
      <field ref="event_title" input_lookup_url="{$config{rel_cgipath}}/users/lookup/event_by_name" required="yes" />
      <field ref="event_type" required="yes" />
      <field ref="event_location"/>
      <field ref="event_dates"/>
    </component>
  </epc:if>

<!-- This field is not really intended to be edited directly by users.
  <component><field ref="relation"/></component>
-->

  <component id="c_contact_email" collapse="yes"><field ref="contact_email"/></component>
  <component id="c_referencetext" collapse="yes"><field ref="referencetext"/></component>
  <component id="c_keywords" collapse="yes"><field ref="keywords"/></component>
  <component id="c_note" collapse="yes"><field ref="note"/></component>
  <component id="c_suggestions" collapse="yes"><field ref="suggestions"/></component>

</stage>

